# [OS] 프로세스와 스레드

> 간단하게 말하면 프로세스는 실행중인 프로그램을 말하고, 스레드는 프로세스 실행의 단위를 뜻한다.

## 프로세스(Process)

> 프로그램? 파일이 저장 장치에 저장되어 잇지만 메모리에는 올라가 있지 않은 정적인 상태

-   메모리에 올라와 실행중인 프로그램
-   운영체제로부터 시스템 자원을 할당받는 단위
-   할당받는 시스템 자원에는 CPU 시간, 주소공간, 메모리 영역(Code, Data, Heap, Stack)이 있다.
    -   stack 영역: arguments, return address, local variables 등과 같은 임시 자료를 저장
    -   data 영역: 전역 변수를 저장
    -   heap 영역: 프로세스 실행 중 동적으로 할당되는 영역
    -   각 프로세스는 별도의 주소 공간에 실행되며, 다른 프로세스의 자원에 접근하려면 통신(IPC...)이 필요
    -   그렇다면 운영체제에서는 이런 프로세스들을 어떻게 관리할까?

### PCB(Process Control Block)

-   프로세스에 대한 중요한 정보를 저장하고 있는 운영체제의 자료구조
-   운영체제는 프로세스를 관리하기 위해 프로세스의 생성과 동시에 고유한 PCB를 생성
-   프로세스가 전환될 때, 이전 프로세스 작업의 진행상황을 PCB에 저장(Context Switching)
-   저장되는 정보 (자세한 정보는 이후 chapter에서 정리 예정)
    _ PID(Process ID): 프로세스 식별번호
    _ 프로그램 Counter: 프로세스가 다음에 실행할 명령어의 주소
    _ CPU 레지스터
    _ CPU 스케쥴링 정보: 프로세스의 우선순위, 스케줄 큐에 대한 pointer 등
    _ 메모리 관리 정보: 페이지 테이블 또는 세그먼트 테이블 등과 같은 정보 포함
    _ 입출력 상태 정보: 프로세스에 할당된 입출력 장치들과 열린 파일 목록
    _ accounting 정보: 사용된 CPU 시간, 시간제한, 계정번호 등
    _ 프로세스 상태: new, ready, running, waiting, terminated 등의 상태를 저장

            ![image](https://user-images.githubusercontent.com/42240771/105043674-27e19480-5aa9-11eb-9e31-6c1f0a3fd597.png)

    프로세스 상태 변화 표

> 프로세스에서 스레드로?  
> -> 과거에는 프로그램을 실행할 때 프로세스 하나만을 사용해서 진행  
> -> 프로그램이 복잡해 지면서 하나만 사용하기에는 벅차짐  
> -> 더 작은 실행 단위 개념이 필요  
> -> 스레드의 탄생

---

## 스레드(Thread)

-   프로세스 실행의 단위
-   스레드는 레지스터와 stack만 따로 할당받고, 나머지 운영체제 자원인 code, data, heap 영역은 공유
-   멀티스레딩을 수행해야하기 때문에 각자의 stack과 레지스터 값을 갖는다.
-   스레드는 스레드ID, 프로그램 counter, 레지스터 집합, stack으로 구성
    > Stack을 독립적으로 할당하는 이유?  
    > -> stack은 함수 호칠시 전달되는 argument, return address, local variables를 저장  
    > -> 이러한 공간이 독립적이라는 것은 독립적인 함수 호출이 가능하다는 것  
    > -> 이는 독립적인 실행 흐름이 추가되는 것  
    > -> 즉, 스레드의 독립적 작업 수행을 지원하기 위한 최소 조건으로 독립된 스택을 할당

> PC 레지스터를 독립적으로 할당하는 이유?  
> -> PC 값은 스레드가 명령어의 어디까지 수행했는지를 나타냄  
> -> 스레드는 CPU를 할당받았다가 스케줄러에 의해 다시 선점 당함 (차례 뺏김)  
> -> 따라서 다음 명령어 위치를 기억해둘 필요가 있음  
> -> 이를 위해 PC 레지스터를 독립적으로 할당
